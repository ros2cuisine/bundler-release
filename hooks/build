#!/bin/bash

BUILD_ARCH=$(echo "${DOCKERFILE_PATH}" | rev | cut -d '.' -f 2 | rev)

docker build --squash \
    --file "${DOCKERFILE_PATH}" \
    --build-arg BUILD_DATE="$(date -u +"%Y-%m-%dT%H:%M:%SZ")" \
    --build-arg VCS_REF="$(git rev-parse --short HEAD)" \
    --build-arg ROS_DISTRO=eloquent \
    --build-arg DOCKER_REPO="${DOCKER_REPO}" \
    --build-arg TARGET_ARCH=$(echo "${DOCKER_TAG}" | cut -d '-' -f 2 | rev | cut -d '-' -f 2 | rev) \
    --build-arg DOCKERHUB_REPO=bundler \
    --build-arg DOCKERHUB_NAME=ros2cuisine \
    --build-arg ROS_DISTRO=eloquent \
    --build-arg FLAVOR_VERSION=eloquent-ros-core \
    --tag "${IMAGE_NAME}" \
    .
